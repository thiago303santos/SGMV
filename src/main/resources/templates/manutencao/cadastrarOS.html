<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Cadastrar Ordem de Serviço</title>
    <link rel="stylesheet" th:href="@{/lib/bootstrap/css/bootstrap.min.css}" />
    <script th:src="@{/lib/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script>
        function toggleClienteNovo() {
            const isNovo = document.getElementById("clienteNovo").checked;
            document.getElementById("clienteExistenteDiv").style.display = isNovo ? "none" : "block";
            document.getElementById("novoClienteDiv").style.display = isNovo ? "block" : "none";
        }
    </script>
</head>
<body class="container mt-4">
<div th:replace="~{fragments/_navbar :: navbar(${notificacoes}, ${usuarioNome})}"></div>

    <h2 class="mb-4">Cadastrar Ordem de Serviço</h2>

    <form th:action="@{/manutencao/salvar}" method="post" class="row g-3">

        <!-- Escolher cliente existente OU novo -->
        <div class="col-12">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="clienteNovo" onclick="toggleClienteNovo()">
                <label class="form-check-label" for="clienteNovo">Cadastrar novo cliente</label>
            </div>
        </div>

        <!-- Cliente existente -->
        <div id="clienteExistenteDiv" class="col-12">
            <label for="idCliente" class="form-label">Selecione o Cliente</label>
            <select name="idCliente" id="idCliente" class="form-select">
                <option value="">-- Escolha --</option>
                <option th:each="cliente : ${clientes}"
                        th:value="${cliente.idCliente}"
                        th:text="${cliente.nomeCliente}">
                </option>
            </select>

            <label for="idVeiculo" class="form-label mt-3">Selecione o Veículo</label>
            <select name="idVeiculo" id="idVeiculo" class="form-select">
                <option value="">-- Escolha --</option>
                <!-- Aqui você pode carregar dinamicamente os veículos via JS quando selecionar o cliente -->
            </select>
        </div>

        <!-- Novo cliente -->
        <div id="novoClienteDiv" class="col-12" style="display:none;">
            <h5 class="mt-3">Dados do Cliente</h5>
            <div class="row">
                <div class="col-md-6">
                    <label class="form-label">Nome</label>
                    <input type="text" class="form-control" name="nomeCliente">
                </div>
                <div class="col-md-3">
                    <label class="form-label">CPF</label>
                    <input type="text" class="form-control" name="cpfCliente">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Telefone</label>
                    <input type="text" class="form-control" name="telefoneCliente">
                </div>
                <div class="col-md-6 mt-2">
                    <label class="form-label">E-mail</label>
                    <input type="email" class="form-control" name="emailCliente">
                </div>
            </div>

            <h5 class="mt-4">Dados do Veículo</h5>
            <div class="row">
                <div class="col-md-3">
                    <label class="form-label">Placa</label>
                    <input type="text" class="form-control" name="placa">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Modelo</label>
                    <input type="text" class="form-control" name="modelo">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Ano</label>
                    <input type="text" class="form-control" name="ano">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Cor</label>
                    <input type="text" class="form-control" name="cor">
                </div>
                <div class="col-md-4 mt-2">
                    <label class="form-label">Marca</label>
                    <input type="text" class="form-control" name="marca">
                </div>
                <div class="col-md-4 mt-2">
                    <label class="form-label">Tipo</label>
                    <select class="form-select" name="tipoId">
                        <option value="">-- Selecione --</option>
                        <option th:each="tipo : ${tiposVeiculos}" 
                                th:value="${tipo.idTipoVeiculo}" 
                                th:text="${tipo.tipoVeiculo}"></option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Dados da Manutenção -->
        <h5 class="mt-4">Dados da Manutenção</h5>
        <div class="col-md-4">
            <label class="form-label">Data de Entrada</label>
            <input type="date" class="form-control" name="dataEntrada">
        </div>
        <div class="col-md-4">
            <label class="form-label">Quilometragem</label>
            <input type="text" class="form-control" name="quilometragem">
        </div>
        <div class="col-md-12 mt-2">
            <label class="form-label">Descrição</label>
            <textarea class="form-control" rows="3" name="descricao"></textarea>
        </div>
        <div class="col-md-4 mt-2">
            <label class="form-label">Status</label>
            <select class="form-select" name="status">
                <option value="ABERTA">Aberta</option>
                <option value="EM_ANDAMENTO">Em Andamento</option>
                <option value="CONCLUIDA">Concluída</option>
            </select>
        </div>
        <div class="col-md-4 mt-2">
            <label class="form-label">Valor Total</label>
            <input type="number" step="0.01" class="form-control" name="vlTotal">
        </div>

        <!-- Botões -->
        <div class="col-12 mt-4">
            <button type="submit" class="btn btn-success">Salvar OS</button>
            <a th:href="@{/manutencao/lista}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
    <script th:src="@{/lib/bootstrap/js/bootstrap.bundle.min.js}"></script>
</body>
</html>
